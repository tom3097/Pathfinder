<!DOCTYPE html>
<html>
	<head>
	<title>Pathfinder - SPDB</title>
	<meta charset="utf-8">
	<script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>
	<link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/css/ol.css">
	<style>
		#map {
			width: 100%;
		}
	</style>
	</head>
	<body>
		<div id="map"></div>
		<button id="clear">clear</button>
		<script type="text/javascript">
			var map = new ol.Map({
			target: 'map',
			layers: [
				new ol.layer.Tile({
					source: new ol.source.OSM()
				})
			],
			view: new ol.View({
				center: ol.proj.transform([21.0004, 52.2261], 'EPSG:4326', 'EPSG:3857'),
				zoom: 7
			}),
			controls: ol.control.defaults({
				attributionOptions: {
					collapsible: false
				}
			})
			});

			var params = {
				LAYERS: 'pgrouting:pgrouting',
				FORMAT: 'image/png'
			}

			// The "start" and "destination" features.
			var startPoint = new ol.Feature();
			var destPoint = new ol.Feature();

			// The vector layer used to display the "start" and "destination" features.
			var vectorLayer = new ol.layer.Vector({
			source: new ol.source.Vector({
				features: [startPoint, destPoint]
			})
			});
			map.addLayer(vectorLayer);

			// A transform function to convert coordinates from EPSG:3857
			// to EPSG:4326.
			var transform = ol.proj.getTransform('EPSG:3857', 'EPSG:4326');

			// Register a map click listener.
			map.on('click', function(event) {
			if (startPoint.getGeometry() == null) {
				// First click.
				startPoint.setGeometry(new ol.geom.Point(event.coordinate));
			} else if (destPoint.getGeometry() == null) {
				// Second click.
				destPoint.setGeometry(new ol.geom.Point(event.coordinate));
				// Transform the coordinates from the map projection (EPSG:3857)
				// to the server projection (EPSG:4326).
				var startCoord = transform(startPoint.getGeometry().getCoordinates());
				var destCoord = transform(destPoint.getGeometry().getCoordinates());
				var viewparams = [
					'x1:' + startCoord[0], 'y1:' + startCoord[1],
					'x2:' + destCoord[0], 'y2:' + destCoord[1]
				];
				params.viewparams = viewparams.join(';');
				result = new ol.layer.Image({
					source: new ol.source.ImageWMS({
						url: 'http://localhost:8082/geoserver/pgrouting/wms',
						params: params
					})
				});
				map.addLayer(result);
			}
			});

			var clearButton = document.getElementById('clear');
			clearButton.addEventListener('click', function(event) {
				// Reset the "start" and "destination" features.
				startPoint.setGeometry(null);
				destPoint.setGeometry(null);
				// Remove the result layer.
				map.removeLayer(result);
			});
		</script>
	</body>
</html>